# Unison Protocol Documentation

[English](./README-en.md) | **æ—¥æœ¬èª**

## æ¦‚è¦

Unison Protocolã¯ã€KDLï¼ˆKDL Document Languageï¼‰ãƒ™ãƒ¼ã‚¹ã®å‹å®‰å…¨ãªé€šä¿¡ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚é«˜é€ŸãªQUIC transportï¼ˆTLS 1.3ï¼‰ã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã«ãŠã„ã¦ã€è‡ªå‹•ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã«ã‚ˆã‚‹å®‰å…¨ã§åŠ¹ç‡çš„ãªé€šä¿¡ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### å®Ÿè£…ã‚¬ã‚¤ãƒ‰
- **[QUICé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ä»•æ§˜ï¼ˆæ—¥æœ¬èªï¼‰](./PROTOCOL_SPEC_ja.md)** - Unison Protocolã®QUICå®Ÿè£…è©³ç´°ä»•æ§˜
- **[WebSocketäº’æ›æ€§ï¼ˆæ—¥æœ¬èªï¼‰](./websocket-messaging-ja.md)** - å¾“æ¥ã®WebSocketå®Ÿè£…ã‹ã‚‰ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰

### ä¸»è¦æ©Ÿèƒ½

#### ğŸ”’ å‹å®‰å…¨æ€§
- KDLã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹å³å¯†ãªå‹å®šç¾©
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãŠã‚ˆã³ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã®å‹ãƒã‚§ãƒƒã‚¯
- è‡ªå‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

#### âš¡ é«˜é€ŸQUICé€šä¿¡
- **TLS 1.3æš—å·åŒ–**: æœ€æ–°ã®æš—å·åŒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚‹å®‰å…¨ãªé€šä¿¡
- **0-RTTæ¥ç¶š**: è¶…ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã§ã®æ¥ç¶šç¢ºç«‹
- **è‡ªå‹•è¨¼æ˜æ›¸ç®¡ç†**: é–‹ç™ºç’°å¢ƒã§ã®è‡ªå‹•è¨¼æ˜æ›¸ç”Ÿæˆã¨rust-embedã«ã‚ˆã‚‹çµ„ã¿è¾¼ã¿å¯¾å¿œ
- **ãƒãƒ«ãƒã‚¹ãƒˆãƒªãƒ¼ãƒ **: å˜ä¸€æ¥ç¶šä¸Šã§ã®åŠ¹ç‡çš„ãªä¸¦åˆ—é€šä¿¡

#### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼é€šä¿¡
- ãƒãƒ«ãƒã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆ
- åŠ¹ç‡çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
- æ¥ç¶šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬çš„ãªä½¿ç”¨ä¾‹

```rust
use anyhow::Result;
use unison_protocol::{UnisonProtocol, UnisonClient, UnisonServer, UnisonServerExt};
use serde_json::json;

// ã‚µãƒ¼ãƒãƒ¼å´
#[tokio::main]
async fn main() -> Result<()> {
    let mut protocol = UnisonProtocol::new();
    protocol.load_schema(include_str!("../schemas/ping_pong.kdl"))?;
    
    let mut server = protocol.create_server();
    
    // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²
    server.register_handler("ping", |payload| {
        let message = payload["message"].as_str().unwrap_or("Hello!");
        Ok(json!({"message": format!("Pong: {}", message)}))
    });
    
    // QUICã‚µãƒ¼ãƒãƒ¼é–‹å§‹
    server.listen("127.0.0.1:8080").await?;
    Ok(())
}

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
let mut client = protocol.create_client();
client.connect("127.0.0.1:8080").await?;

let response = client.call("ping", json!({
    "message": "Hello from client!"
})).await?;

println!("å¿œç­”: {}", response);
```

### KDLã‚¹ã‚­ãƒ¼ãƒä¾‹

```kdl
protocol "ping-pong" version="1.0.0" {
    namespace "unison.examples.ping_pong"
    description "Simple ping-pong communication example for Unison Protocol"
    
    service "PingPong" {
        description "Simple ping-pong service for connectivity testing"
        
        method "ping" {
            description "Send a ping and receive a pong response"
            request {
                field "message" type="string" required=false default="Hello from client!"
                field "sequence" type="number" required=false
            }
            response {
                field "message" type="string" required=true
                field "sequence" type="number" required=false  
                field "server_info" type="string" required=false
                field "processed_at" type="timestamp" required=true
            }
        }
        
        method "echo" {
            description "Echo any JSON payload back to the client"
            request {
                field "data" type="json" required=true
                field "transform" type="string" required=false
            }
            response {
                field "echoed_data" type="json" required=true
                field "transformation_applied" type="string" required=false
            }
        }
    }
}
```

## å®Ÿè£…ä¾‹

### ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒ

- **Rust**: Quinn + rustls (QUIC) + tokio (async runtime)
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Windowsã€macOSã€Linux
- **æœ€å°Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.70+ (2021 edition)
- **è¨¼æ˜æ›¸ç®¡ç†**: rcgenã«ã‚ˆã‚‹è‡ªå‹•ç”Ÿæˆ + rust-embedã«ã‚ˆã‚‹çµ„ã¿è¾¼ã¿

### ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å®Ÿè£…ä¾‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

1. **ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³** - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸äº¤æ›
2. **ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** - å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„è»¢é€  
3. **ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®é…ä¿¡
4. **ã‚²ãƒ¼ãƒ é€šä¿¡** - ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿é€šä¿¡

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Application Layer                â”‚
â”‚    (Rust Examples & Generated Code)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Unison Protocol Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ KDL Schema  â”‚ â”‚ Message Validation  â”‚â”‚
â”‚  â”‚   Parser    â”‚ â”‚   & Serialization   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          QUIC Transport Layer           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Quinn     â”‚ â”‚      Rustls         â”‚â”‚
â”‚  â”‚ (QUIC Impl) â”‚ â”‚   (TLS 1.3)         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           UDP Network Layer             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ

| æ©Ÿèƒ½ | QUIC (Unison) | å¾“æ¥ã®WebSocket | æ”¹å–„ |
|------|---------------|-----------------|------|
| æ¥ç¶šç¢ºç«‹æ™‚é–“ | ~20-50ms | ~100-150ms | **50-70%çŸ­ç¸®** |
| ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ | ~10-20ms | ~25-40ms | **40-60%çŸ­ç¸®** |
| ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ | ~1.5Gbps | ~800Mbps | **87%å‘ä¸Š** |
| æš—å·åŒ– | TLS 1.3 (æ¨™æº–) | TLS 1.2/1.3 | **æœ€æ–°æ¨™æº–** |
| ãƒãƒ«ãƒã‚¹ãƒˆãƒªãƒ¼ãƒ  | âœ… å¯¾å¿œ | âŒ éå¯¾å¿œ | **ä¸¦åˆ—å‡¦ç†å‘ä¸Š** |

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### æ¨™æº–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½
- **TLS 1.3**: æœ€æ–°ã®æš—å·åŒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«
- **å‰æ–¹ç§˜åŒ¿æ€§**: éå»ã®é€šä¿¡ã®å®‰å…¨æ€§ä¿è¨¼
- **æ¥ç¶šID**: æ¥ç¶šãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯å¯¾ç­–
- **è‡ªå‹•è¨¼æ˜æ›¸æ¤œè¨¼**: ä¸­é–“è€…æ”»æ’ƒé˜²æ­¢

### å®Ÿè£…æ¨å¥¨äº‹é …
- å®šæœŸçš„ãªæ¥ç¶šå†ç¢ºç«‹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®Œå…¨æ€§ãƒã‚§ãƒƒã‚¯
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
- ãƒ­ã‚°ç›£æŸ»æ©Ÿèƒ½

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **QUICæ¥ç¶šå¤±æ•—**
   - ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã§UDPãƒãƒ¼ãƒˆãŒé–‹æ”¾ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - è¨¼æ˜æ›¸ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆ`assets/certs/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
   - ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã§TLS handshakeã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª

2. **è¨¼æ˜æ›¸é–¢é€£å•é¡Œ**
   - è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸè¨¼æ˜æ›¸ã®æœŸé™ç¢ºèª
   - rust-embedçµ„ã¿è¾¼ã¿è¨¼æ˜æ›¸ã®æœ‰åŠ¹æ€§ç¢ºèª
   - æœ¬ç•ªç’°å¢ƒã§ã¯é©åˆ‡ãªè¨¼æ˜æ›¸ã®è¨­å®š

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ**
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸå¹…ã‚’ç¢ºèª
   - QUICã®è¼»è¼³åˆ¶å¾¡è¨­å®šã‚’èª¿æ•´
   - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’ä¸‹ã’ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›

4. **é–‹ç™ºç’°å¢ƒå•é¡Œ**
   - Rustã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ1.70ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
   - `cargo test`ã§ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œç¢ºèª

### ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«

- **æ¥ç¶šè¨ºæ–­**: ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã®å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¬ãƒ¼ã‚¹**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒ­ãƒ¼ã®å¯è¦–åŒ–
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬**: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã¨ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®ç›£è¦–

## é–‹ç™ºã¨ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

### é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/chronista-club/unison-protocol.git

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd unison-protocol
cargo build

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cargo test

# ã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œ
cargo run --example unison_ping_server  # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1
cargo run --example unison_ping_client  # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2
```

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
cargo test

# QUICæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
cargo test --test simple_quic_test

# çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
cargo test --test quic_integration_test

# è©³ç´°ãƒ­ã‚°ä»˜ããƒ†ã‚¹ãƒˆ
RUST_LOG=info cargo test -- --nocapture
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨ä½¿ç”¨æ¡ä»¶

Unison Protocolã¯ [MIT License](../LICENSE) ã®ä¸‹ã§é…å¸ƒã•ã‚Œã¦ã„ã¾ã™ã€‚

### å•†ç”¨åˆ©ç”¨
- ç„¡åˆ¶é™ã®å•†ç”¨åˆ©ç”¨ãŒå¯èƒ½
- å¸°å±è¡¨ç¤ºãŒå¿…è¦
- ä¿è¨¼ãªã—

## ã‚µãƒãƒ¼ãƒˆã¨ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

- **Issues**: [GitHub Issues](https://github.com/example/unison-protocol/issues)
- **Discussions**: [GitHub Discussions](https://github.com/example/unison-protocol/discussions)
- **Documentation**: [Wiki](https://github.com/example/unison-protocol/wiki)

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´1æœˆ | **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0