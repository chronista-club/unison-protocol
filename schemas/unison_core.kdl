// Unison Protocol Core Definitions
// Version: 1.0.0
// 
// Unison Protocol is a KDL-based type-safe communication framework
// that enables seamless client-server communication with automatic
// code generation for multiple languages.

protocol "unison-core" version="1.0.0" {
    namespace "unison.core"
    description "Core protocol definitions for Unison communication framework"
    
    // Base message structure for all Unison communications
    message "UnisonMessage" {
        description "Standard message format for Unison protocol"
        field "id" type="string" required=#true description="Unique message identifier"
        field "method" type="string" required=#true description="RPC method name"
        field "payload" type="json" required=#true description="Method parameters as JSON"
        field "timestamp" type="timestamp" required=#true description="Message creation timestamp"
        field "version" type="string" required=#false default="1.0.0" description="Protocol version"
    }
    
    // Standard response structure
    message "UnisonResponse" {
        description "Standard response format for Unison protocol"
        field "id" type="string" required=#true description="Corresponding request message ID"
        field "success" type="bool" required=#true description="Operation success indicator"
        field "payload" type="json" required=#false description="Response data as JSON"
        field "error" type="string" required=#false description="Error message if operation failed"
        field "timestamp" type="timestamp" required=#true description="Response creation timestamp"
        field "version" type="string" required=#false default="1.0.0" description="Protocol version"
    }
    
    // Error information structure
    message "UnisonError" {
        description "Structured error information for Unison protocol"
        field "code" type="string" required=#true description="Error code identifier"
        field "message" type="string" required=#true description="Human-readable error message"
        field "details" type="json" required=#false description="Additional error context"
        field "timestamp" type="timestamp" required=#true description="Error occurrence timestamp"
    }
    
    // Core protocol services
    service "UnisonCore" {
        description "Essential Unison protocol services for connection management"
        
        // Protocol handshake method
        method "handshake" {
            description "Establish protocol version compatibility and exchange capabilities"
            request {
                field "protocol_version" type="string" required=#true description="Client protocol version"
                field "client_name" type="string" required=#true description="Client application identifier"
                field "client_version" type="string" required=#false description="Client application version"
                field "supported_features" type="array" item_type="string" description="List of client-supported features"
            }
            response {
                field "server_version" type="string" required=#true description="Server protocol version"
                field "server_name" type="string" required=#true description="Server application identifier"
                field "supported_features" type="array" item_type="string" description="List of server-supported features"
                field "session_id" type="string" required=#true description="Unique session identifier"
                field "heartbeat_interval" type="number" required=#false description="Heartbeat interval in milliseconds"
            }
        }
        
        // Connection health check
        method "ping" {
            description "Connection health check mechanism"
            request {
                field "timestamp" type="timestamp" required=#true description="Ping timestamp"
                field "payload" type="string" required=#false description="Optional ping payload"
            }
            response {
                field "timestamp" type="timestamp" required=#true description="Pong timestamp"
                field "payload" type="string" required=#false description="Echo of ping payload"
                field "server_time" type="timestamp" required=#true description="Server current timestamp"
            }
        }
        
        // Graceful connection termination
        method "disconnect" {
            description "Gracefully close the connection"
            request {
                field "reason" type="string" required=#false description="Reason for disconnection"
            }
            response {
                field "acknowledged" type="bool" required=#true description="Disconnection acknowledgment"
                field "message" type="string" required=#false description="Server farewell message"
            }
        }
    }
}